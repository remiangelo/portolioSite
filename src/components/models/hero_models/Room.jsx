/*
Auto-generated by: https://github.com/pmndrs/gltfjsx
Command: npx gltfjsx@6.5.3 optimized-room.glb 
*/

import React, { useRef, useMemo } from "react";
import { useGLTF, useTexture } from "@react-three/drei";
import { EffectComposer, SelectiveBloom } from "@react-three/postprocessing";
import { BlendFunction } from "postprocessing";
import * as THREE from "three";
import { useFrame } from "@react-three/fiber";

export function Room(props) {
  const { nodes, materials } = useGLTF("/models/optimized-room.glb");
  const screensRef = useRef();
  const groupRef = useRef();
  const matcapTexture = useTexture("/images/textures/mat1.png");

  // Optimize materials by creating them once with useMemo
  const optimizedMaterials = useMemo(() => {
    return {
      curtain: new THREE.MeshPhongMaterial({
        color: "#d90429",
        shininess: 30,
        flatShading: false,
      }),
      
      body: new THREE.MeshPhongMaterial({
        map: matcapTexture,
        shininess: 50,
      }),
      
      table: new THREE.MeshPhongMaterial({
        color: "#582f0e",
        shininess: 60,
      }),
      
      radiator: new THREE.MeshPhongMaterial({
        color: "#fff",
        shininess: 80,
      }),
      
      comp: new THREE.MeshStandardMaterial({
        color: "#fff",
        roughness: 0.2,
        metalness: 0.8,
      }),
      
      pillow: new THREE.MeshPhongMaterial({
        color: "#8338ec",
        shininess: 10,
      }),
      
      chair: new THREE.MeshPhongMaterial({
        color: "#000",
        shininess: 40,
      })
    };
  }, [matcapTexture]);
  
  // Add subtle animation to the screens
  useFrame((state) => {
    if (screensRef.current) {
      // Subtle pulsing effect for the screens
      screensRef.current.material.emissiveIntensity = 1 + Math.sin(state.clock.elapsedTime * 2) * 0.2;
    }
  });

  return (
    <group {...props} dispose={null} ref={groupRef}>
      <EffectComposer>
        <SelectiveBloom
          selection={screensRef}
          intensity={1.5} // Strength of the bloom
          luminanceThreshold={0.2} // Minimum luminance needed
          luminanceSmoothing={0.9} // Smooth transition
          blendFunction={BlendFunction.ADD} // How it blends
        />
      </EffectComposer>
      <mesh
        geometry={nodes._________6_blinn1_0.geometry}
        material={optimizedMaterials.curtain}
      />
      <mesh geometry={nodes.body1_blinn1_0.geometry} material={optimizedMaterials.body} />
      <mesh geometry={nodes.cabin_blinn1_0.geometry} material={optimizedMaterials.table} />
      <mesh
        geometry={nodes.chair_body_blinn1_0.geometry}
        material={optimizedMaterials.chair}
      />
      <mesh geometry={nodes.comp_blinn1_0.geometry} material={optimizedMaterials.comp} />
      <mesh
        ref={screensRef}
        geometry={nodes.emis_lambert1_0.geometry}
        material={materials.lambert1}
      />
      <mesh
        geometry={nodes.handls_blinn1_0.geometry}
        material={materials.blinn1}
      />
      <mesh
        geometry={nodes.keyboard_blinn1_0.geometry}
        material={materials.blinn1}
      />
      <mesh
        geometry={nodes.kovrik_blinn1_0.geometry}
        material={materials.blinn1}
      />
      <mesh
        geometry={nodes.lamp_bl_blinn1_0.geometry}
        material={materials.blinn1}
      />
      <mesh
        geometry={nodes.lamp_white_blinn1_0.geometry}
        material={materials.blinn1}
      />
      <mesh
        geometry={nodes.miuse_blinn1_0.geometry}
        material={materials.blinn1}
      />
      <mesh
        geometry={nodes.monitor2_blinn1_0.geometry}
        material={materials.blinn1}
      />
      <mesh
        geometry={nodes.monitor3_blinn1_0.geometry}
        material={materials.blinn1}
      />
      <mesh
        geometry={nodes.pCylinder5_blinn1_0.geometry}
        material={materials.blinn1}
      />
      <mesh
        geometry={nodes.pillows_blinn1_0.geometry}
        material={optimizedMaterials.pillow}
      />
      <mesh
        geometry={nodes.polySurface53_blinn1_0.geometry}
        material={materials.blinn1}
      />
      <mesh
        geometry={nodes.radiator_blinn1_0.geometry}
        material={optimizedMaterials.radiator}
      />
      <mesh
        geometry={nodes.radiator_blinn1_0001.geometry}
        material={materials.blinn1}
      />
      <mesh
        geometry={nodes.railing_blinn1_0.geometry}
        material={materials.blinn1}
      />
      <mesh
        geometry={nodes.red_bttns_blinn1_0.geometry}
        material={materials.blinn1}
      />
      <mesh
        geometry={nodes.red_vac_blinn1_0.geometry}
        material={materials.blinn1}
      />
      <mesh
        geometry={nodes.stylus_blinn1_0.geometry}
        material={materials.blinn1}
      />
      <mesh geometry={nodes.table_blinn1_0.geometry} material={optimizedMaterials.table} />
      <mesh
        geometry={nodes.tablet_blinn1_0.geometry}
        material={materials.blinn1}
      />
      <mesh
        geometry={nodes.triangle_blinn1_0.geometry}
        material={materials.blinn1}
      />
      <mesh
        geometry={nodes.vac_black_blinn1_0.geometry}
        material={materials.blinn1}
      />
      <mesh
        geometry={nodes.vacuum1_blinn1_0.geometry}
        material={materials.blinn1}
      />
      <mesh
        geometry={nodes.vacuumgrey_blinn1_0.geometry}
        material={materials.blinn1}
      />
      <mesh
        geometry={nodes.vires_blinn1_0.geometry}
        material={materials.blinn1}
      />
      <mesh
        geometry={nodes.window_blinn1_0.geometry}
        material={materials.blinn1}
      />
      <mesh
        geometry={nodes.window4_phong1_0.geometry}
        material={materials.phong1}
      />
    </group>
  );
}

useGLTF.preload("/models/optimized-room.glb");
